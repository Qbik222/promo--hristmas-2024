"use strict";

(function () {
  // Cards slider
  var cardsContainer = document.querySelector('.prize__list'),
    cards = document.querySelectorAll('.prize__list-item'),
    cardsWrap = document.querySelector('.prize__list-scroll'),
    moveRightButton = document.querySelector('.prize__slider-move-right'),
    moveLeftButton = document.querySelector('.prize__slider-move-left'),
    tabsContainer = document.querySelector('.prize__tabs'),
    totalCards = cards.length,
    cardWidth = cards[0].clientWidth,
    cardsMargin = (cardsWrap.clientWidth - cardWidth * totalCards) / (totalCards - 1),
    visibleSlides = Math.floor(cardsContainer.clientWidth / (cardWidth + cardsMargin)),
    totalTabs = Math.ceil(totalCards / visibleSlides);
  var currentSlide = 1;
  var cardsPosition = 0;
  for (var i = 1; i < totalTabs; i++) {
    var tab = document.createElement('div');
    tab.classList.add('prize__tabs-item');
    tabsContainer.appendChild(tab);
  }
  var updateTabs = function updateTabs() {
    var activeTab = Math.ceil(currentSlide / visibleSlides);
    tabsContainer.childNodes.forEach(function (tab, index) {
      tab.classList.toggle('_active', index + 1 === activeTab);
    });
  };
  updateTabs();
  var setCardsPosition = function setCardsPosition(position) {
    cardsWrap.style.transform = "translateX(-".concat(position, "px)");
  };
  var moveRight = function moveRight() {
    if (currentSlide >= totalCards - visibleSlides) {
      currentSlide = 1;
      cardsPosition = 0;
    } else {
      var maxPosition = (totalCards - visibleSlides) * (cardWidth + cardsMargin);
      if (cardsPosition + cardWidth + cardsMargin > maxPosition) {
        cardsPosition = maxPosition;
        currentSlide = totalCards - visibleSlides + 1;
      } else {
        cardsPosition += cardWidth + cardsMargin;
        currentSlide++;
      }
    }
    setCardsPosition(cardsPosition);
    updateTabs();
  };
  var moveLeft = function moveLeft() {
    if (currentSlide === 1) {
      currentSlide = totalCards - visibleSlides;
      cardsPosition = (totalCards - visibleSlides) * (cardWidth + cardsMargin) - (cardWidth + cardsMargin);
    } else if (currentSlide === 2) {
      cardsPosition = 0;
      currentSlide = 1;
    } else {
      cardsPosition -= cardWidth + cardsMargin;
      currentSlide--;
    }
    setCardsPosition(cardsPosition);
    updateTabs();
    console.log(currentSlide);
  };

  // snowfall animations
  (function () {
    var COUNT = 400;
    function Snowstorm(element) {
      this.masthead = element;
      this.canvas = document.createElement('canvas');
      this.ctx = this.canvas.getContext('2d');
      this.width = this.masthead.clientWidth;
      this.height = this.masthead.clientHeight;
      this.active = false;
      this.snowflakes = [];
      this.init();
    }
    Snowstorm.prototype.init = function () {
      this.canvas.style.position = 'absolute';
      this.canvas.style.left = this.canvas.style.top = '0';
      this.masthead.appendChild(this.canvas);
      this.onResize();
      window.addEventListener('resize', this.onResize.bind(this), false);
      for (var i = 0; i < COUNT; i++) {
        var snowflake = new this.Snowflake(this);
        snowflake.reset();
        this.snowflakes.push(snowflake);
      }
      if (this.active) {
        requestAnimFrame(this.update.bind(this));
      }
    };
    Snowstorm.prototype.onResize = function () {
      this.width = this.masthead.clientWidth;
      this.height = this.masthead.clientHeight;
      this.canvas.width = this.width;
      this.canvas.height = this.height;
      this.ctx.fillStyle = '#FFF';
      var wasActive = this.active;
      this.active = this.width > 80;
      this.width > 280 ? COUNT = 150 : null;
      if (!wasActive && this.active) {
        requestAnimFrame(this.update.bind(this));
      }
    };
    Snowstorm.prototype.update = function () {
      this.ctx.clearRect(0, 0, this.width, this.height);
      if (!this.active) {
        return;
      }
      for (var i = 0; i < COUNT; i++) {
        var snowflake = this.snowflakes[i];
        snowflake.y += snowflake.vy;
        snowflake.x += snowflake.vx;
        this.ctx.globalAlpha = snowflake.o;
        this.ctx.beginPath();
        this.ctx.arc(snowflake.x, snowflake.y, snowflake.r, 0, Math.PI * 2, false);
        this.ctx.closePath();
        this.ctx.fill();
        if (snowflake.y > this.height) {
          snowflake.reset();
        }
      }
      requestAnimFrame(this.update.bind(this));
    };
    Snowstorm.prototype.Snowflake = function (snowstorm) {
      this.snowstorm = snowstorm;
      this.reset();
    };
    Snowstorm.prototype.Snowflake.prototype.reset = function () {
      this.x = Math.random() * this.snowstorm.width;
      this.y = Math.random() * -this.snowstorm.height;
      this.vy = 1 + Math.random() * 0.00001;
      this.vx = 0.5 - Math.random();
      this.r = 1 + Math.random() * 2;
      this.o = 1;
    };

    // shim layer with setTimeout fallback
    window.requestAnimFrame = function () {
      return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (callback) {
        window.setTimeout(callback, 1000 / 60);
      };
    }();

    // Apply Snowstorm to all elements with the class 'sky'
    var skies = document.querySelectorAll('.sky');
    skies.forEach(function (sky) {
      new Snowstorm(sky);
    });
  })();
  var handleResize = function handleResize() {
    var touchStartX = 0;
    var touchEndX = 0;
    var handleTouchStart = function handleTouchStart(event) {
      touchStartX = event.touches[0].clientX;
    };
    var handleTouchMove = function handleTouchMove(event) {
      touchEndX = event.touches[0].clientX;
    };
    var handleTouchEnd = function handleTouchEnd() {
      var swipeDistance = touchStartX - touchEndX;
      if (swipeDistance > 50) {
        // Свайп ліворуч
        moveRight();
      } else if (swipeDistance < -50) {
        // Свайп праворуч
        moveLeft();
      }
      // Скидаємо значення
      touchStartX = 0;
      touchEndX = 0;
    };
    moveRightButton.addEventListener('click', moveRight);
    moveLeftButton.addEventListener('click', moveLeft);
    cardsContainer.addEventListener('touchstart', handleTouchStart);
    cardsContainer.addEventListener('touchmove', handleTouchMove);
    cardsContainer.addEventListener('touchend', handleTouchEnd);
  };
  handleResize();
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiY2FyZHNDb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjYXJkcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjYXJkc1dyYXAiLCJtb3ZlUmlnaHRCdXR0b24iLCJtb3ZlTGVmdEJ1dHRvbiIsInRhYnNDb250YWluZXIiLCJ0b3RhbENhcmRzIiwibGVuZ3RoIiwiY2FyZFdpZHRoIiwiY2xpZW50V2lkdGgiLCJjYXJkc01hcmdpbiIsInZpc2libGVTbGlkZXMiLCJNYXRoIiwiZmxvb3IiLCJ0b3RhbFRhYnMiLCJjZWlsIiwiY3VycmVudFNsaWRlIiwiY2FyZHNQb3NpdGlvbiIsImkiLCJ0YWIiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJ1cGRhdGVUYWJzIiwiYWN0aXZlVGFiIiwiY2hpbGROb2RlcyIsImZvckVhY2giLCJpbmRleCIsInRvZ2dsZSIsInNldENhcmRzUG9zaXRpb24iLCJwb3NpdGlvbiIsInN0eWxlIiwidHJhbnNmb3JtIiwibW92ZVJpZ2h0IiwibWF4UG9zaXRpb24iLCJtb3ZlTGVmdCIsImNvbnNvbGUiLCJsb2ciLCJDT1VOVCIsIlNub3dzdG9ybSIsImVsZW1lbnQiLCJtYXN0aGVhZCIsImNhbnZhcyIsImN0eCIsImdldENvbnRleHQiLCJ3aWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsImFjdGl2ZSIsInNub3dmbGFrZXMiLCJpbml0IiwicHJvdG90eXBlIiwibGVmdCIsInRvcCIsIm9uUmVzaXplIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImJpbmQiLCJzbm93Zmxha2UiLCJTbm93Zmxha2UiLCJyZXNldCIsInB1c2giLCJyZXF1ZXN0QW5pbUZyYW1lIiwidXBkYXRlIiwiZmlsbFN0eWxlIiwid2FzQWN0aXZlIiwiY2xlYXJSZWN0IiwieSIsInZ5IiwieCIsInZ4IiwiZ2xvYmFsQWxwaGEiLCJvIiwiYmVnaW5QYXRoIiwiYXJjIiwiciIsIlBJIiwiY2xvc2VQYXRoIiwiZmlsbCIsInNub3dzdG9ybSIsInJhbmRvbSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1velJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNhbGxiYWNrIiwic2V0VGltZW91dCIsInNraWVzIiwic2t5IiwiaGFuZGxlUmVzaXplIiwidG91Y2hTdGFydFgiLCJ0b3VjaEVuZFgiLCJoYW5kbGVUb3VjaFN0YXJ0IiwiZXZlbnQiLCJ0b3VjaGVzIiwiY2xpZW50WCIsImhhbmRsZVRvdWNoTW92ZSIsImhhbmRsZVRvdWNoRW5kIiwic3dpcGVEaXN0YW5jZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFlBQVk7RUFDVDtFQUNBLElBQU1BLGNBQWMsR0FBR0MsUUFBUSxDQUFDQyxhQUFhLENBQUMsY0FBYyxDQUFDO0lBQ3ZEQyxLQUFLLEdBQUdGLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMsbUJBQW1CLENBQUM7SUFDdERDLFNBQVMsR0FBR0osUUFBUSxDQUFDQyxhQUFhLENBQUMscUJBQXFCLENBQUM7SUFDekRJLGVBQWUsR0FBR0wsUUFBUSxDQUFDQyxhQUFhLENBQUMsMkJBQTJCLENBQUM7SUFDckVLLGNBQWMsR0FBR04sUUFBUSxDQUFDQyxhQUFhLENBQUMsMEJBQTBCLENBQUM7SUFDbkVNLGFBQWEsR0FBR1AsUUFBUSxDQUFDQyxhQUFhLENBQUMsY0FBYyxDQUFDO0lBQ3RETyxVQUFVLEdBQUdOLEtBQUssQ0FBQ08sTUFBTTtJQUN6QkMsU0FBUyxHQUFHUixLQUFLLENBQUMsQ0FBQyxDQUFDLENBQUNTLFdBQVc7SUFDaENDLFdBQVcsR0FBRyxDQUFDUixTQUFTLENBQUNPLFdBQVcsR0FBR0QsU0FBUyxHQUFHRixVQUFVLEtBQUtBLFVBQVUsR0FBRyxDQUFDLENBQUM7SUFDakZLLGFBQWEsR0FBR0MsSUFBSSxDQUFDQyxLQUFLLENBQUNoQixjQUFjLENBQUNZLFdBQVcsSUFBSUQsU0FBUyxHQUFHRSxX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QUFFbEIsQ0FBQyxHQUFHIiwiZmlsZSI6Im1haW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gKCkge1xuICAgIC8vIENhcmRzIHNsaWRlclxuICAgIGNvbnN0IGNhcmRzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByaXplX19saXN0JyksXG4gICAgICAgICAgY2FyZHMgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKCcucHJpemVfX2xpc3QtaXRlbScpLFxuICAgICAgICAgIGNhcmRzV3JhcCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcml6ZV9fbGlzdC1zY3JvbGwnKSxcbiAgICAgICAgICBtb3ZlUmlnaHRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJpemVfX3NsaWRlci1tb3ZlLXJpZ2h0JyksXG4gICAgICAgICAgbW92ZUxlZnRCdXR0b24gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJpemVfX3NsaWRlci1tb3ZlLWxlZnQnKSxcbiAgICAgICAgICB0YWJzQ29udGFpbmVyID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByaXplX190YWJzJyksXG4gICAgICAgICAgdG90YWxDYXJkcyA9IGNhcmRzLmxlbmd0aCxcbiAgICAgICAgICBjYXJkV2lkdGggPSBjYXJkc1swXS5jbGllbnRXaWR0aCxcbiAgICAgICAgICBjYXJkc01hcmdpbiA9IChjYXJkc1dyYXAuY2xpZW50V2lkdGggLSBjYXJkV2lkdGggKiB0b3RhbENhcmRzKSAvICh0b3RhbENhcmRzIC0gMSksXG4gICAgICAgICAgdmlzaWJsZVNsaWRlcyA9IE1hdGguZmxvb3IoY2FyZHNDb250YWluZXIuY2xpZW50V2lkdGggLyAoY2FyZFdpZHRoICsgY2FyZHNNYXJnaW4pKSxcbiAgICAgICAgICB0b3RhbFRhYnMgPSBNYXRoLmNlaWwodG90YWxDYXJkcyAvIHZpc2libGVTbGlkZXMpXG5cbiAgICBsZXQgY3VycmVudFNsaWRlID0gMTtcbiAgICBsZXQgY2FyZHNQb3NpdGlvbiA9IDA7XG4gICAgZm9yIChsZXQgaSA9IDE7IGkgPCB0b3RhbFRhYnM7IGkrKykge1xuICAgICAgICBjb25zdCB0YWIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKTtcbiAgICAgICAgdGFiLmNsYXNzTGlzdC5hZGQoJ3ByaXplX190YWJzLWl0ZW0nKTtcbiAgICAgICAgdGFic0NvbnRhaW5lci5hcHBlbmRDaGlsZCh0YWIpO1xuICAgIH1cbiAgICBjb25zdCB1cGRhdGVUYWJzID0gKCkgPT4ge1xuICAgICAgICBjb25zdCBhY3RpdmVUYWIgPSBNYXRoLmNlaWwoY3VycmVudFNsaWRlIC8gdmlzaWJsZVNsaWRlcyk7XG4gICAgICAgIHRhYnNDb250YWluZXIuY2hpbGROb2Rlcy5mb3JFYWNoKCh0YWIsIGluZGV4KSA9PiB7XG4gICAgICAgICAgICB0YWIuY2xhc3NMaXN0LnRvZ2dsZSgnX2FjdGl2ZScsIGluZGV4ICsgMSA9PT0gYWN0aXZlVGFiKTtcbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICB1cGRhdGVUYWJzKCk7XG4gICAgY29uc3Qgc2V0Q2FyZHNQb3NpdGlvbiA9IChwb3NpdGlvbikgPT4ge1xuICAgICAgICBjYXJkc1dyYXAuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoLSR7cG9zaXRpb259cHgpYDtcbiAgICB9O1xuICAgIGNvbnN0IG1vdmVSaWdodCA9ICgpID0+IHtcbiAgICAgICAgaWYgKGN1cnJlbnRTbGlkZSA+PSB0b3RhbENhcmRzIC0gdmlzaWJsZVNsaWRlcykge1xuICAgICAgICAgICAgY3VycmVudFNsaWRlID0gMTtcbiAgICAgICAgICAgIGNhcmRzUG9zaXRpb24gPSAwO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgY29uc3QgbWF4UG9zaXRpb24gPSAodG90YWxDYXJkcyAtIHZpc2libGVTbGlkZXMpICogKGNhcmRXaWR0aCArIGNhcmRzTWFyZ2luKTtcbiAgICAgICAgICAgIGlmIChjYXJkc1Bvc2l0aW9uICsgY2FyZFdpZHRoICsgY2FyZHNNYXJnaW4gPiBtYXhQb3NpdGlvbikge1xuICAgICAgICAgICAgICAgIGNhcmRzUG9zaXRpb24gPSBtYXhQb3NpdGlvbjtcbiAgICAgICAgICAgICAgICBjdXJyZW50U2xpZGUgPSB0b3RhbENhcmRzIC0gdmlzaWJsZVNsaWRlcyArIDE7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgIGNhcmRzUG9zaXRpb24gKz0gY2FyZFdpZHRoICsgY2FyZHNNYXJnaW47XG4gICAgICAgICAgICAgICAgY3VycmVudFNsaWRlKys7XG4gICAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgc2V0Q2FyZHNQb3NpdGlvbihjYXJkc1Bvc2l0aW9uKTtcbiAgICAgICAgdXBkYXRlVGFicygpO1xuICAgIH07XG4gICAgY29uc3QgbW92ZUxlZnQgPSAoKSA9PiB7XG4gICAgICAgIGlmKGN1cnJlbnRTbGlkZSA9PT0gMSl7XG4gICAgICAgICAgICBjdXJyZW50U2xpZGUgPSB0b3RhbENhcmRzIC0gdmlzaWJsZVNsaWRlcztcbiAgICAgICAgICAgIGNhcmRzUG9zaXRpb24gPSAoKHRvdGFsQ2FyZHMgLSB2aXNpYmxlU2xpZGVzKSAqIChjYXJkV2lkdGggKyBjYXJkc01hcmdpbikpIC0oY2FyZFdpZHRoICsgY2FyZHNNYXJnaW4pO1xuICAgICAgICB9ZWxzZSBpZiAoY3VycmVudFNsaWRlID09PSAyKSB7XG4gICAgICAgICAgICBjYXJkc1Bvc2l0aW9uID0gMFxuICAgICAgICAgICAgY3VycmVudFNsaWRlID0gMVxuICAgICAgICB9ZWxzZSB7XG4gICAgICAgICAgICBjYXJkc1Bvc2l0aW9uIC09IGNhcmRXaWR0aCArIGNhcmRzTWFyZ2luO1xuICAgICAgICAgICAgY3VycmVudFNsaWRlLS1cbiAgICAgICAgfVxuICAgICAgICBzZXRDYXJkc1Bvc2l0aW9uKGNhcmRzUG9zaXRpb24pO1xuICAgICAgICB1cGRhdGVUYWJzKCk7XG4gICAgICAgIGNvbnNvbGUubG9nKGN1cnJlbnRTbGlkZSlcbiAgICB9O1xuXG4gICAgLy8gc25vd2ZhbGwgYW5pbWF0aW9uc1xuICAgIChmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBDT1VOVCA9IDQwMDtcblxuICAgICAgICBmdW5jdGlvbiBTbm93c3Rvcm0oZWxlbWVudCkge1xuICAgICAgICAgICAgdGhpcy5tYXN0aGVhZCA9IGVsZW1lbnQ7XG4gICAgICAgICAgICB0aGlzLmNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpO1xuICAgICAgICAgICAgdGhpcy5jdHggPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMubWFzdGhlYWQuY2xpZW50V2lkdGg7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMubWFzdGhlYWQuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5hY3RpdmUgPSBmYWxzZTtcbiAgICAgICAgICAgIHRoaXMuc25vd2ZsYWtlcyA9IFtdO1xuXG4gICAgICAgICAgICB0aGlzLmluaXQoKTtcbiAgICAgICAgfVxuXG4gICAgICAgIFNub3dzdG9ybS5wcm90b3R5cGUuaW5pdCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLnN0eWxlLnBvc2l0aW9uID0gJ2Fic29sdXRlJztcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLnN0eWxlLmxlZnQgPSB0aGlzLmNhbnZhcy5zdHlsZS50b3AgPSAnMCc7XG4gICAgICAgICAgICB0aGlzLm1hc3RoZWFkLmFwcGVuZENoaWxkKHRoaXMuY2FudmFzKTtcblxuICAgICAgICAgICAgdGhpcy5vblJlc2l6ZSgpO1xuICAgICAgICAgICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMub25SZXNpemUuYmluZCh0aGlzKSwgZmFsc2UpO1xuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IENPVU5UOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgc25vd2ZsYWtlID0gbmV3IHRoaXMuU25vd2ZsYWtlKHRoaXMpO1xuICAgICAgICAgICAgICAgIHNub3dmbGFrZS5yZXNldCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuc25vd2ZsYWtlcy5wdXNoKHNub3dmbGFrZSk7XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmFjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltRnJhbWUodGhpcy51cGRhdGUuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgU25vd3N0b3JtLnByb3RvdHlwZS5vblJlc2l6ZSA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMud2lkdGggPSB0aGlzLm1hc3RoZWFkLmNsaWVudFdpZHRoO1xuICAgICAgICAgICAgdGhpcy5oZWlnaHQgPSB0aGlzLm1hc3RoZWFkLmNsaWVudEhlaWdodDtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLndpZHRoID0gdGhpcy53aWR0aDtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzLmhlaWdodCA9IHRoaXMuaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5jdHguZmlsbFN0eWxlID0gJyNGRkYnO1xuXG4gICAgICAgICAgICB2YXIgd2FzQWN0aXZlID0gdGhpcy5hY3RpdmU7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IHRoaXMud2lkdGggPiA4MDtcbiAgICAgICAgICAgIHRoaXMud2lkdGggPiAyODAgPyBDT1VOVCA9IDE1MCA6IG51bGxcblxuICAgICAgICAgICAgaWYgKCF3YXNBY3RpdmUgJiYgdGhpcy5hY3RpdmUpIHtcbiAgICAgICAgICAgICAgICByZXF1ZXN0QW5pbUZyYW1lKHRoaXMudXBkYXRlLmJpbmQodGhpcykpO1xuICAgICAgICAgICAgfVxuICAgICAgICB9O1xuXG4gICAgICAgIFNub3dzdG9ybS5wcm90b3R5cGUudXBkYXRlID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jdHguY2xlYXJSZWN0KDAsIDAsIHRoaXMud2lkdGgsIHRoaXMuaGVpZ2h0KTtcblxuICAgICAgICAgICAgaWYgKCF0aGlzLmFjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCBDT1VOVDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgdmFyIHNub3dmbGFrZSA9IHRoaXMuc25vd2ZsYWtlc1tpXTtcbiAgICAgICAgICAgICAgICBzbm93Zmxha2UueSArPSBzbm93Zmxha2Uudnk7XG4gICAgICAgICAgICAgICAgc25vd2ZsYWtlLnggKz0gc25vd2ZsYWtlLnZ4O1xuXG4gICAgICAgICAgICAgICAgdGhpcy5jdHguZ2xvYmFsQWxwaGEgPSBzbm93Zmxha2UubztcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5iZWdpblBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5hcmMoc25vd2ZsYWtlLngsIHNub3dmbGFrZS55LCBzbm93Zmxha2UuciwgMCwgTWF0aC5QSSAqIDIsIGZhbHNlKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5jbG9zZVBhdGgoKTtcbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5maWxsKCk7XG5cbiAgICAgICAgICAgICAgICBpZiAoc25vd2ZsYWtlLnkgPiB0aGlzLmhlaWdodCkge1xuICAgICAgICAgICAgICAgICAgICBzbm93Zmxha2UucmVzZXQoKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG5cbiAgICAgICAgICAgIHJlcXVlc3RBbmltRnJhbWUodGhpcy51cGRhdGUuYmluZCh0aGlzKSk7XG4gICAgICAgIH07XG5cbiAgICAgICAgU25vd3N0b3JtLnByb3RvdHlwZS5Tbm93Zmxha2UgPSBmdW5jdGlvbiAoc25vd3N0b3JtKSB7XG4gICAgICAgICAgICB0aGlzLnNub3dzdG9ybSA9IHNub3dzdG9ybTtcbiAgICAgICAgICAgIHRoaXMucmVzZXQoKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTbm93c3Rvcm0ucHJvdG90eXBlLlNub3dmbGFrZS5wcm90b3R5cGUucmVzZXQgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLnggPSBNYXRoLnJhbmRvbSgpICogdGhpcy5zbm93c3Rvcm0ud2lkdGg7XG4gICAgICAgICAgICB0aGlzLnkgPSBNYXRoLnJhbmRvbSgpICogLXRoaXMuc25vd3N0b3JtLmhlaWdodDtcbiAgICAgICAgICAgIHRoaXMudnkgPSAxICsgTWF0aC5yYW5kb20oKSAqIDAuMDAwMDE7XG4gICAgICAgICAgICB0aGlzLnZ4ID0gMC41IC0gTWF0aC5yYW5kb20oKTtcbiAgICAgICAgICAgIHRoaXMuciA9IDEgKyBNYXRoLnJhbmRvbSgpICogMjtcbiAgICAgICAgICAgIHRoaXMubyA9IDE7XG4gICAgICAgIH07XG5cbiAgICAgICAgLy8gc2hpbSBsYXllciB3aXRoIHNldFRpbWVvdXQgZmFsbGJhY2tcbiAgICAgICAgd2luZG93LnJlcXVlc3RBbmltRnJhbWUgPSAoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgcmV0dXJuIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgICAgICB3aW5kb3cud2Via2l0UmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICAgICAgd2luZG93Lm1velJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uIChjYWxsYmFjaykge1xuICAgICAgICAgICAgICAgICAgICB3aW5kb3cuc2V0VGltZW91dChjYWxsYmFjaywgMTAwMCAvIDYwKTtcbiAgICAgICAgICAgICAgICB9O1xuICAgICAgICB9KSgpO1xuXG4gICAgICAgIC8vIEFwcGx5IFNub3dzdG9ybSB0byBhbGwgZWxlbWVudHMgd2l0aCB0aGUgY2xhc3MgJ3NreSdcbiAgICAgICAgdmFyIHNraWVzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnNreScpO1xuICAgICAgICBza2llcy5mb3JFYWNoKGZ1bmN0aW9uIChza3kpIHtcbiAgICAgICAgICAgIG5ldyBTbm93c3Rvcm0oc2t5KTtcbiAgICAgICAgfSk7XG4gICAgfSkoKTtcblxuICAgIGNvbnN0IGhhbmRsZVJlc2l6ZSA9ICgpID0+e1xuICAgICAgICBsZXQgdG91Y2hTdGFydFggPSAwO1xuICAgICAgICBsZXQgdG91Y2hFbmRYID0gMDtcbiAgICAgICAgY29uc3QgaGFuZGxlVG91Y2hTdGFydCA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdG91Y2hTdGFydFggPSBldmVudC50b3VjaGVzWzBdLmNsaWVudFg7XG4gICAgICAgIH07XG4gICAgICAgIGNvbnN0IGhhbmRsZVRvdWNoTW92ZSA9IChldmVudCkgPT4ge1xuICAgICAgICAgICAgdG91Y2hFbmRYID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRYO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBoYW5kbGVUb3VjaEVuZCA9ICgpID0+IHtcbiAgICAgICAgICAgIGNvbnN0IHN3aXBlRGlzdGFuY2UgPSB0b3VjaFN0YXJ0WCAtIHRvdWNoRW5kWDtcbiAgICAgICAgICAgIGlmIChzd2lwZURpc3RhbmNlID4gNTApIHtcbiAgICAgICAgICAgICAgICAvLyDQodCy0LDQudC/INC70ZbQstC+0YDRg9GHXG4gICAgICAgICAgICAgICAgbW92ZVJpZ2h0KCk7XG4gICAgICAgICAgICB9IGVsc2UgaWYgKHN3aXBlRGlzdGFuY2UgPCAtNTApIHtcbiAgICAgICAgICAgICAgICAvLyDQodCy0LDQudC/INC/0YDQsNCy0L7RgNGD0YdcbiAgICAgICAgICAgICAgICBtb3ZlTGVmdCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgLy8g0KHQutC40LTQsNGU0LzQviDQt9C90LDRh9C10L3QvdGPXG4gICAgICAgICAgICB0b3VjaFN0YXJ0WCA9IDA7XG4gICAgICAgICAgICB0b3VjaEVuZFggPSAwO1xuICAgICAgICB9O1xuXG4gICAgICAgIG1vdmVSaWdodEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG1vdmVSaWdodCk7XG4gICAgICAgIG1vdmVMZWZ0QnV0dG9uLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgbW92ZUxlZnQpO1xuICAgICAgICBjYXJkc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaHN0YXJ0JywgaGFuZGxlVG91Y2hTdGFydCk7XG4gICAgICAgIGNhcmRzQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNobW92ZScsIGhhbmRsZVRvdWNoTW92ZSk7XG4gICAgICAgIGNhcmRzQ29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoJ3RvdWNoZW5kJywgaGFuZGxlVG91Y2hFbmQpO1xuICAgIH1cblxuICAgIGhhbmRsZVJlc2l6ZSgpXG5cbn0pKCk7Il19
