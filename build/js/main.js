"use strict";

(function () {
  // Cards slider
  var cardsContainer = document.querySelector('.prize__list'),
    cards = document.querySelectorAll('.prize__list-item'),
    cardsWrap = document.querySelector('.prize__list-scroll'),
    moveRightButton = document.querySelector('.prize__slider-move-right'),
    moveLeftButton = document.querySelector('.prize__slider-move-left'),
    tabsContainer = document.querySelector('.prize__tabs'),
    isMobile = window.innerWidth < 600,
    totalCards = cards.length,
    cardWidth = cards[0].clientWidth,
    cardsMargin = (cardsWrap.clientWidth - cardWidth * totalCards) / (totalCards - 1),
    visibleSlides = isMobile ? 1 : Math.floor(cardsContainer.clientWidth / (cardWidth + cardsMargin)),
    totalTabs = Math.ceil(totalCards / visibleSlides);
  var currentSlide = 1;
  var cardsPosition = 0;
  for (var i = 1; i <= totalTabs; i++) {
    if (!isMobile && i === totalTabs) {
      break;
    }
    var tab = document.createElement('div');
    tab.classList.add('prize__tabs-item');
    tabsContainer.appendChild(tab);
  }
  var updateActiveCard = function updateActiveCard(cards, activeIndex) {
    cards.forEach(function (card, i) {
      activeIndex - 1 === i ? card.classList.add("_active") : card.classList.remove("_active");
    });
  };
  updateActiveCard(cards, currentSlide);
  var updateTabs = function updateTabs() {
    var activeTab = Math.ceil(currentSlide / visibleSlides);
    tabsContainer.childNodes.forEach(function (tab, index) {
      tab.classList.toggle('_active', index + 1 === activeTab);
    });
  };
  updateTabs();
  function setCardsPosition(position) {
    cardsWrap.style.transform = "translateX(-".concat(position, "px)");
  }
  ;
  var moveRight = function moveRight() {
    if (currentSlide >= totalCards - visibleSlides && isMobile === false) {
      currentSlide = 1;
      cardsPosition = 0;
    } else if (currentSlide === totalCards) {
      currentSlide = 1;
      cardsPosition = 0;
    } else {
      var maxPosition = (totalCards - visibleSlides) * (cardWidth + cardsMargin);
      if (cardsPosition + cardWidth + cardsMargin > maxPosition) {
        cardsPosition = maxPosition;
        currentSlide = totalCards - visibleSlides + 1;
      } else {
        cardsPosition += cardWidth + cardsMargin;
        currentSlide++;
      }
    }
    setCardsPosition(cardsPosition);
    updateTabs();
    updateActiveCard(cards, currentSlide);
  };
  var moveLeft = function moveLeft() {
    if (currentSlide === 1 && isMobile === false) {
      currentSlide = totalCards - visibleSlides;
      cardsPosition = (totalCards - visibleSlides) * (cardWidth + cardsMargin) - (cardWidth + cardsMargin);
    } else if (currentSlide === 2) {
      cardsPosition = 0;
      currentSlide = 1;
    } else if (currentSlide === 1 && isMobile === true) {
      currentSlide = totalCards;
      cardsPosition = totalCards * (cardWidth + cardsMargin) - (cardWidth + cardsMargin);
    } else {
      cardsPosition -= cardWidth + cardsMargin;
      currentSlide--;
    }
    setCardsPosition(cardsPosition);
    updateTabs();
    updateActiveCard(cards, currentSlide);
  };

  // function centerStartPosition() {
  //         const startOffset = (window.innerWidth / 2) - ((cardWidth + cardsMargin) / 2);
  //         cardsPosition = startOffset > 0 ? startOffset : 0;
  //         setCardsPosition(cardsPosition);
  // };

  // snowfall animations
  (function () {
    var COUNT = 400;
    function Snowstorm(element) {
      this.masthead = element;
      this.canvas = document.createElement('canvas');
      this.ctx = this.canvas.getContext('2d');
      this.width = this.masthead.clientWidth;
      this.height = this.masthead.clientHeight;
      this.active = false;
      this.snowflakes = [];
      this.init();
    }
    Snowstorm.prototype.init = function () {
      this.canvas.style.position = 'absolute';
      this.canvas.style.left = this.canvas.style.top = '0';
      this.masthead.appendChild(this.canvas);
      this.onResize();
      window.addEventListener('resize', this.onResize.bind(this), false);
      for (var i = 0; i < COUNT; i++) {
        var snowflake = new this.Snowflake(this);
        snowflake.reset();
        this.snowflakes.push(snowflake);
      }
      if (this.active) {
        requestAnimFrame(this.update.bind(this));
      }
    };
    Snowstorm.prototype.onResize = function () {
      this.width = this.masthead.clientWidth;
      this.height = this.masthead.clientHeight;
      this.canvas.width = this.width;
      this.canvas.height = this.height;
      this.ctx.fillStyle = '#FFF';
      var wasActive = this.active;
      this.active = this.width > 80;
      this.width > 280 ? COUNT = 150 : null;
      if (!wasActive && this.active) {
        requestAnimFrame(this.update.bind(this));
      }
    };
    Snowstorm.prototype.update = function () {
      this.ctx.clearRect(0, 0, this.width, this.height);
      if (!this.active) {
        return;
      }
      for (var i = 0; i < COUNT; i++) {
        var snowflake = this.snowflakes[i];
        snowflake.y += snowflake.vy;
        snowflake.x += snowflake.vx;
        this.ctx.globalAlpha = snowflake.o;
        this.ctx.beginPath();
        this.ctx.arc(snowflake.x, snowflake.y, snowflake.r, 0, Math.PI * 2, false);
        this.ctx.closePath();
        this.ctx.fill();
        if (snowflake.y > this.height) {
          snowflake.reset();
        }
      }
      requestAnimFrame(this.update.bind(this));
    };
    Snowstorm.prototype.Snowflake = function (snowstorm) {
      this.snowstorm = snowstorm;
      this.reset();
    };
    Snowstorm.prototype.Snowflake.prototype.reset = function () {
      this.x = Math.random() * this.snowstorm.width;
      this.y = Math.random() * -this.snowstorm.height;
      this.vy = 0.3 + Math.random() * 0.00001;
      this.vx = 0.6 - Math.random();
      this.r = 1 + Math.random() * 2;
      this.o = 1;
    };

    // shim layer with setTimeout fallback
    window.requestAnimFrame = function () {
      return window.requestAnimationFrame || window.webkitRequestAnimationFrame || window.mozRequestAnimationFrame || function (callback) {
        window.setTimeout(callback, 1000 / 60);
      };
    }();

    // Apply Snowstorm to all elements with the class 'sky'
    var skies = document.querySelectorAll('.sky');
    skies.forEach(function (sky) {
      new Snowstorm(sky);
    });
  })();
  var handleResize = function handleResize() {
    var touchStartX = 0;
    var touchEndX = 0;
    var handleTouchStart = function handleTouchStart(event) {
      touchStartX = event.touches[0].clientX;
    };
    var handleTouchMove = function handleTouchMove(event) {
      touchEndX = event.touches[0].clientX;
    };
    var handleTouchEnd = function handleTouchEnd() {
      var swipeDistance = touchStartX - touchEndX;
      if (swipeDistance > 50) {
        // Свайп ліворуч
        moveRight();
      } else if (swipeDistance < -50) {
        // Свайп праворуч
        moveLeft();
      }
      // Скидаємо значення
      touchStartX = 0;
      touchEndX = 0;
    };
    moveRightButton.addEventListener('click', moveRight);
    moveLeftButton.addEventListener('click', moveLeft);
    cardsContainer.addEventListener('touchstart', handleTouchStart);
    cardsContainer.addEventListener('touchmove', handleTouchMove);
    cardsContainer.addEventListener('touchend', handleTouchEnd);
  };
  handleResize();
})();
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm1haW4uanMiXSwibmFtZXMiOlsiY2FyZHNDb250YWluZXIiLCJkb2N1bWVudCIsInF1ZXJ5U2VsZWN0b3IiLCJjYXJkcyIsInF1ZXJ5U2VsZWN0b3JBbGwiLCJjYXJkc1dyYXAiLCJtb3ZlUmlnaHRCdXR0b24iLCJtb3ZlTGVmdEJ1dHRvbiIsInRhYnNDb250YWluZXIiLCJpc01vYmlsZSIsIndpbmRvdyIsImlubmVyV2lkdGgiLCJ0b3RhbENhcmRzIiwibGVuZ3RoIiwiY2FyZFdpZHRoIiwiY2xpZW50V2lkdGgiLCJjYXJkc01hcmdpbiIsInZpc2libGVTbGlkZXMiLCJNYXRoIiwiZmxvb3IiLCJ0b3RhbFRhYnMiLCJjZWlsIiwiY3VycmVudFNsaWRlIiwiY2FyZHNQb3NpdGlvbiIsImkiLCJ0YWIiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NMaXN0IiwiYWRkIiwiYXBwZW5kQ2hpbGQiLCJ1cGRhdGVBY3RpdmVDYXJkIiwiYWN0aXZlSW5kZXgiLCJmb3JFYWNoIiwiY2FyZCIsInJlbW92ZSIsInVwZGF0ZVRhYnMiLCJhY3RpdmVUYWIiLCJjaGlsZE5vZGVzIiwiaW5kZXgiLCJ0b2dnbGUiLCJzZXRDYXJkc1Bvc2l0aW9uIiwicG9zaXRpb24iLCJzdHlsZSIsInRyYW5zZm9ybSIsIm1vdmVSaWdodCIsIm1heFBvc2l0aW9uIiwibW92ZUxlZnQiLCJDT1VOVCIsIlNub3dzdG9ybSIsImVsZW1lbnQiLCJtYXN0aGVhZCIsImNhbnZhcyIsImN0eCIsImdldENvbnRleHQiLCJ3aWR0aCIsImhlaWdodCIsImNsaWVudEhlaWdodCIsImFjdGl2ZSIsInNub3dmbGFrZXMiLCJpbml0IiwicHJvdG90eXBlIiwibGVmdCIsInRvcCIsIm9uUmVzaXplIiwiYWRkRXZlbnRMaXN0ZW5lciIsImJpbmQiLCJzbm93Zmxha2UiLCJTbm93Zmxha2UiLCJyZXNldCIsInB1c2giLCJyZXF1ZXN0QW5pbUZyYW1lIiwidXBkYXRlIiwiZmlsbFN0eWxlIiwid2FzQWN0aXZlIiwiY2xlYXJSZWN0IiwieSIsInZ5IiwieCIsInZ4IiwiZ2xvYmFsQWxwaGEiLCJvIiwiYmVnaW5QYXRoIiwiYXJjIiwiciIsIlBJIiwiY2xvc2VQYXRoIiwiZmlsbCIsInNub3dzdG9ybSIsInJhbmRvbSIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSIsIm1velJlcXVlc3RBbmltYXRpb25GcmFtZSIsImNhbGxiYWNrIiwic2V0VGltZW91dCIsInNraWVzIiwic2t5IiwiaGFuZGxlUmVzaXplIiwidG91Y2hTdGFydFgiLCJ0b3VjaEVuZFgiLCJoYW5kbGVUb3VjaFN0YXJ0IiwiZXZlbnQiLCJ0b3VjaGVzIiwiY2xpZW50WCIsImhhbmRsZVRvdWNoTW92ZSIsImhhbmRsZVRvdWNoRW5kIiwic3dpcGVEaXN0YW5jZSJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxDQUFDLFlBQVk7RUFDVDtFQUNBLElBQU1BLGNBQWMsR0FBR0MsUUFBUSxDQUFDQyxhQUFhLENBQUMsY0FBYyxDQUFDO0lBQ3ZEQyxLQUFLLEdBQUdGLFFBQVEsQ0FBQ0csZ0JBQWdCLENBQUMsbUJBQW1CLENBQUM7SUFDdERDLFNBQVMsR0FBR0osUUFBUSxDQUFDQyxhQUFhLENBQUMscUJBQXFCLENBQUM7SUFDekRJLGVBQWUsR0FBR0wsUUFBUSxDQUFDQyxhQUFhLENBQUMsMkJBQTJCLENBQUM7SUFDckVLLGNBQWMsR0FBR04sUUFBUSxDQUFDQyxhQUFhLENBQUMsMEJBQTBCLENBQUM7SUFDbkVNLGFBQWEsR0FBR1AsUUFBUSxDQUFDQyxhQUFhLENBQUMsY0FBYyxDQUFDO0lBQ3RETyxRQUFRLEdBQUdDLE1BQU0sQ0FBQ0MsVUFBVSxHQUFHLEdBQUc7SUFDbENDLFVBQVUsR0FBR1QsS0FBSyxDQUFDVSxNQUFNO0lBQ3pCQyxTQUFTLEdBQUdYLEtBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQ1ksV0FBVztJQUNoQ0MsV0FBVyxHQUFHLENBQUNYLFNBQVMsQ0FBQ1UsV0FBVyxHQUFHRCxTQUFTLEdBQUdGLFVBQVUsS0FBS0EsVUFBVSxHQUFHLENBQUMsQ0FBQztJQUNqRkssYUFBYSxHQUFHUixRQUFRLEdBQUcsQ0FBQyxHQUFHUyxJQUFJLENBQUNDLEtBQUssQ0FBQ25CLGNBQWMsQ0FBQ2UsV0FBVyxJQUFJRCxTQUFTLEdBQUdFLFdBQVcsQ0FBQyxDQUFDO0lBQ2pHSSxTQUFTLEdBQUdGLElBQUksQ0FBQ0csSUFBSSxDQUFDVCxVQUFVLEdBQUdLLGFBQWEsQ0FBQztFQUV2RCxJQUFJSyxZQUFZLEdBQUcsQ0FBQztFQUNwQixJQUFJQyxhQUFhLEdBQUcsQ0FBQztFQUNqQixLQUFLLElBQUlDLENBQUMsR0FBRyxDQUFDLEVBQUVBLENBQUMsSUFBSUosU0FBUyxFQUFFSSxDQUFDLEVBQUUsRUFBRTtJQUNqQyxJQUFHLENBQUNmLFFBQVEsSUFBSWUsQ0FBQyxLQUFLSixTQUFTLEVBQUU7TUFDN0I7SUFDSjtJQUNBLElBQU1LLEdBQUcsR0FBR3hCLFFBQVEsQ0FBQ3lCLGFBQWEsQ0FBQyxLQUFLLENBQUM7SUFDekNELEdBQUcsQ0FBQ0UsU0FBUyxDQUFDQyxHQUFHLENBQUMsa0JBQWtCLENBQUM7SUFDckNwQixhQUFhLENBQUNxQixXQUFXLENBQUNKLEdBQUcsQ0FBQztFQUNsQztFQUVKLElBQU1LLGdCQUFnQixHQUFHLFNBQW5CQSxnQkFBZ0IsQ0FBSTNCLEtBQUssRUFBRTRCLFdBQVcsRUFBSztJQUM3QzVCLEtBQUssQ0FBQzZCLE9BQU8sQ0FBQyxVQUFDQyxJQUFJLEVBQUVULENBQUMsRUFBSTtNQUN0Qk8sV0FBVyxHQUFHLENBQUMsS0FBS1AsQ0FBQyxHQUFHUyxJQUFJLENBQUNOLFNBQVMsQ0FBQ0MsR0FBRyxDQUFDLFNBQVMsQ0FBQyxHQUFHSyxJQUFJLENBQUNOLFNBQVMsQ0FBQ08sTUFBTSxDQUFDLFNBQVMsQ0FBQztJQUM1RixDQUFDLENBQUM7RUFDTixDQUFDO0VBQ0RKLGdCQUFnQixDQUFDM0IsS0FBSyxFQUFFbUIsWUFBWSxDQUFDO0VBRXJDLElBQU1hLFVBQVUsR0FBRyxTQUFiQSxVQUFVLEdBQVM7SUFDckIsSUFBTUMsU0FBUyxHQUFHbEIsSUFBSSxDQUFDRyxJQUFJLENBQUNDLFlBQVksR0FBR0wsYUFBYSxDQUFDO0lBQ3pEVCxhQUFhLENBQUM2QixVQUFVLENBQUNMLE9BQU8sQ0FBQyxVQUFDUCxHQUFHLEVBQUVhLEtBQUssRUFBSztNQUM3Q2IsR0FBRyxDQUFDRSxTQUFTLENBQUNZLE1BQU0sQ0FBQyxTQUFTLEVBQUVELEtBQUssR0FBRyxDQUFDLEtBQUtGLFNBQVMsQ0FBQztJQUM1RCxDQUFDLENBQUM7RUFDTixDQUFDO0VBQ0RELFVBQVUsRUFBRTtFQUNaLFNBQVNLLGdCQUFnQixDQUFFQyxRQUFRLEVBQUU7SUFDakNwQyxTQUFTLENBQUNxQyxLQUFLLENBQUNDLFNBQVMseUJBQWtCRixRQUFRLFFBQUs7RUFDNUQ7RUFBQztFQUNELElBQU1HLFNBQVMsR0FBRyxTQUFaQSxTQUFTLEdBQVM7SUFDcEIsSUFBSXRCLFlBQVksSUFBSVYsVUFBVSxHQUFHSyxhQUFhLElBQUlSLFFBQVEsS0FBSyxLQUFLLEVBQUU7TUFDbEVhLFlBQVksR0FBRyxDQUFDO01BQ2hCQyxhQUFhLEdBQUcsQ0FBQztJQUNyQixDQUFDLE1BQUssSUFBR0QsWUFBWSxLQUFLVixVQUFVLEVBQUU7TUFDbENVLFlBQVksR0FBRyxDQUFDO01BQ2hCQyxhQUFhLEdBQUcsQ0FBQztJQUNyQixDQUFDLE1BQUs7TUFDRixJQUFNc0IsV0FBVyxHQUFHLENBQUNqQyxVQUFVLEdBQUdLLGFBQWEsS0FBS0gsU0FBUyxHQUFHRSxXQUFXLENBQUM7TUFDNUUsSUFBSU8sYUFBYSxHQUFHVCxTQUFTLEdBQUdFLFdBQVcsR0FBRzZCLFdBQVcsRUFBRTtRQUN2RHRCLGFBQWEsR0FBR3NCLFdBQVc7UUFDM0J2QixZQUFZLEdBQUdWLFVBQVUsR0FBR0ssYUFBYSxHQUFHLENBQUM7TUFDakQsQ0FBQyxNQUFNO1FBQ0hNLGFBQWEsSUFBSVQsU0FBUyxHQUFHRSxXQUFXO1FBQ3hDTSxZQUFZLEVBQUU7TUFDbEI7SUFDSjtJQUNBa0IsZ0JBQWdCLENBQUNqQixhQUFhLENBQUM7SUFDL0JZLFVBQVUsRUFBRTtJQUNaTCxnQkFBZ0IsQ0FBQzNCLEtBQUssRUFBRW1CLFlBQVksQ0FBQztFQUN6QyxDQUFDO0VBQ0QsSUFBTXdCLFFBQVEsR0FBRyxTQUFYQSxRQUFRLEdBQVM7SUFDbkIsSUFBR3hCLFlBQVksS0FBSyxDQUFDLElBQUliLFFBQVEsS0FBSyxLQUFLLEVBQUM7TUFDeENhLFlBQVksR0FBR1YsVUFBVSxHQUFHSyxhQUFhO01BQ3pDTSxhQUFhLEdBQUksQ0FBQ1gsVUFBVSxHQUFHSyxhQUFhLEtBQUtILFNBQVMsR0FBR0UsV0FBVyxDQUFDLElBQUlGLFNBQVMsR0FBR0UsV0FBVyxDQUFDO0lBQ3pHLENBQUMsTUFBSyxJQUFJTSxZQUFZLEtBQUssQ0FBQyxFQUFFO01BQzFCQyxhQUFhLEdBQUcsQ0FBQztNQUNqQkQsWUFBWSxHQUFHLENBQUM7SUFDcEIsQ0FBQyxNQUFLLElBQUdBLFlBQVksS0FBSyxDQUFDLElBQUliLFFBQVEsS0FBSyxJQUFJLEVBQUM7TUFDN0NhLFlBQVksR0FBR1YsVUFBVTtNQUN6QlcsYUFBYSxHQUFHWCxVQUFVLElBQUtFLFNBQVMsR0FBR0UsV0FBVyxDQUFDLElBQUlGLFNBQVMsR0FBR0UsV0FBVyxDQUFDO0lBQ3ZGLENBQUMsTUFBSztNQUNGTyxhQUFhLElBQUlULFNBQVMsR0FBR0UsV0FBVztNQUN4Q00sWUFBWSxFQUFFO0lBQ2xCO0lBQ0FrQixnQkFBZ0IsQ0FBQ2pCLGFBQWEsQ0FBQztJQUMvQlksVUFBVSxFQUFFO0lBQ1pMLGdCQUFnQixDQUFDM0IsS0FBSyxFQUFFbUIsWUFBWSxDQUFDO0VBQ3pDLENBQUM7O0VBRUQ7RUFDQTtFQUNBO0VBQ0E7RUFDQTs7RUFNQTtFQUNBLENBQUMsWUFBWTtJQUNULElBQUl5QixLQUFLLEdBQUcsR0FBRztJQUVmLFNBQVNDLFNBQVMsQ0FBQ0MsT0FBTyxFQUFFO01BQ3hCLElBQUksQ0FBQ0MsUUFBUSxHQUFHRCxPQUFPO01BQ3ZCLElBQUksQ0FBQ0UsTUFBTSxHQUFHbEQsUUFBUSxDQUFDeUIsYUFBYSxDQUFDLFFBQVEsQ0FBQztNQUM5QyxJQUFJLENBQUMwQixHQUFHLEdBQUcsSUFBSSxDQUFDRCxNQUFNLENBQUNFLFVBQVUsQ0FBQyxJQUFJLENBQUM7TUFDdkMsSUFBSSxDQUFDQyxLQUFLLEdBQUcsSUFBSSxDQUFDSixRQUFRLENBQUNuQyxXQUFXO01BQ3RDLElBQUksQ0FBQ3dDLE1BQU0sR0FBRyxJQUFJLENBQUNMLFFBQVEsQ0FBQ00sWUFBWTtNQUN4QyxJQUFJLENBQUNDLE1BQU0sR0FBRyxLQUFLO01BQ25CLElBQUksQ0FBQ0MsVUFBVSxHQUFHLEVBQUU7TUFFcEIsSUFBSSxDQUFDQyxJQUFJLEVBQUU7SUFDZjtJQUVBWCxTQUFTLENBQUNZLFNBQVMsQ0FBQ0QsSUFBSSxHQUFHLFlBQVk7TUFDbkMsSUFBSSxDQUFDUixNQUFNLENBQUNULEtBQUssQ0FBQ0QsUUFBUSxHQUFHLFVBQVU7TUFDdkMsSUFBSSxDQUFDVSxNQUFNLENBQUNULEtBQUssQ0FBQ21CLElBQUksR0FBRyxJQUFJLENBQUNWLE1BQU0sQ0FBQ1QsS0FBSyxDQUFDb0IsR0FBRyxHQUFHLEdBQUc7TUFDcEQsSUFBSSxDQUFDWixRQUFRLENBQUNyQixXQUFXLENBQUMsSUFBSSxDQUFDc0IsTUFBTSxDQUFDO01BRXRDLElBQUksQ0FBQ1ksUUFBUSxFQUFFO01BQ2ZyRCxNQUFNLENBQUNzRCxnQkFBZ0IsQ0FBQyxRQUFRLEVBQUUsSUFBSSxDQUFDRCxRQUFRLENBQUNFLElBQUksQ0FBQyxJQUFJLENBQUMsRUFBRSxLQUFLLENBQUM7TUFFbEUsS0FBSyxJQUFJekMsQ0FBQyxHQUFHLENBQUMsRUFBRUEsQ0FBQyxHQUFHdUIsS0FBSyxFQUFFdkIsQ0FBQyxFQUFFLEVBQUU7UUFDNUIsSUFBSTBDLFNBQVMsR0FBRyxJQUFJLElBQUksQ0FBQ0MsU0FBUyxDQUFDLElBQUksQ0FBQztRQUN4Q0QsU0FBUyxDQUFDRSxLQUFLLEVBQUU7UUFDakIsSUFBSSxDQUFDVixVQUFVLENBQUNXLElBQUksQ0FBQ0gsU0FBUyxDQUFDO01BQ25DO01BRUEsSUFBSSxJQUFJLENBQUNULE1BQU0sRUFBRTtRQUNiYSxnQkFBZ0IsQ0FBQyxJQUFJLENBQUNDLE1BQU0sQ0FBQ04sSUFBSSxDQUFDLElBQUksQ0FBQyxDQUFDO01BQzVDO0lBQ0osQ0FBQztJQUVEakIsU0FBUyxDQUFDWSxTQUFTLENBQUNHLFFBQVEsR0FBRyxZQUFZO01BQ3ZDLElBQUksQ0FBQ1QsS0FBSyxHQUFHLElBQUksQ0FBQ0osUUFBUSxDQUFDbkMsV0FBVztNQUN0QyxJQUFJLENBQUN3QyxNQUFNLEdBQUcsSUFBSSxDQUFDTCxRQUFRLENBQUNNLFlBQVk7TUFDeEMsSUFBSSxDQUFDTCxNQUFNLENBQUNHLEtBQUssR0FBRyxJQUFJLENBQUNBLEtBQUs7TUFDOUIsSUFBSSxDQUFDSCxNQUFNLENBQUNJLE1BQU0sR0FBRyxJQUFJLENBQUNBLE1BQU07TUFDaEMsSUFBSSxDQUFDSCxHQUFHLENBQUNvQixTQUFTLEdBQUcsTUFBTTtNQUUzQixJQUFJQyxTQUFTLEdBQUcsSUFBSSxDQUFDaEIsTUFBTTtNQUMzQixJQUFJLENBQUNBLE1BQU0sR0FBRyxJQUFJLENBQUNILEtBQUssR0FBRyxFQUFFO01BQzdCLElBQUksQ0FBQ0EsS0FBSyxHQUFHLEdBQUcsR0FBR1AsS0FBSyxHQUFHLEdBQUcsR0FBRyxJQUFJO01BRXJDLElBQUksQ0FBQzBCLFNBQVMsSUFBSSxJQUFJLENBQUNoQixNQUFNLEVBQUU7UUFDM0JhLGdCQUFnQixDQUFDLElBQUksQ0FBQ0MsTUFBTSxDQUFDTixJQUFJLENBQUMsSUFBSSxDQUFDLENBQUM7TUFDNUM7SUFDSixDQUFDO0lBRURqQixTQUFTLENBQUNZLFNBQVMsQ0FBQ1csTUFBTSxHQUFHLFlBQVk7TUFDckMsSUFBSSxDQUFDbkIsR0FBRyxDQUFDc0IsU0FBUyxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsSUFBSSxDQUFDcEIsS0FBSyxFQUFFLElBQUksQ0FBQ0MsTUFBTSxDQUFDO01BRWpELElBQUksQ0FBQyxJQUFJLENBQUNFLE1BQU0sRUFBRTtRQUNkO01BQ0o7TUFFQSxLQUFLLElBQUlqQyxDQUFDLEdBQUcsQ0FBQyxFQUFFQSxDQUFDLEdBQUd1QixLQUFLLEVBQUV2QixDQUFDLEVBQUUsRUFBRTtRQUM1QixJQUFJMEMsU0FBUyxHQUFHLElBQUksQ0FBQ1IsVUFBVSxDQUFDbEMsQ0FBQyxDQUFDO1FBQ2xDMEMsU0FBUyxDQUFDUyxDQUFDLElBQUlULFNBQVMsQ0FBQ1UsRUFBRTtRQUMzQlYsU0FBUyxDQUFDVyxDQUFDLElBQUlYLFNBQVMsQ0FBQ1ksRUFBRTtRQUUzQixJQUFJLENBQUMxQixHQUFHLENBQUMyQixXQUFXLEdBQUdiLFNBQVMsQ0FBQ2MsQ0FBQztRQUNsQyxJQUFJLENBQUM1QixHQUFHLENBQUM2QixTQUFTLEVBQUU7UUFDcEIsSUFBSSxDQUFDN0IsR0FBRyxDQUFDOEIsR0FBRyxDQUFDaEIsU0FBUyxDQUFDVyxDQUFDLEVBQUVYLFNBQVMsQ0FBQ1MsQ0FBQyxFQUFFVCxTQUFTLENBQUNpQixDQUFDLEVBQUUsQ0FBQyxFQUFFakUsSUFBSSxDQUFDa0UsRUFBRSxHQUFHLENBQUMsRUFBRSxLQUFLLENBQUM7UUFDMUUsSUFBSSxDQUFDaEMsR0FBRyxDQUFDaUMsU0FBUyxFQUFFO1FBQ3BCLElBQUksQ0FBQ2pDLEdBQUcsQ0FBQ2tDLElBQUksRUFBRTtRQUVmLElBQUlwQixTQUFTLENBQUNTLENBQUMsR0FBRyxJQUFJLENBQUNwQixNQUFNLEVBQUU7VUFDM0JXLFNBQVMsQ0FBQ0UsS0FBSyxFQUFFO1FBQ3JCO01BQ0o7TUFFQUUsZ0JBQWdCLENBQUMsSUFBSSxDQUFDQyxNQUFNLENBQUNOLElBQUksQ0FBQyxJQUFJLENBQUMsQ0FBQztJQUM1QyxDQUFDO0lBRURqQixTQUFTLENBQUNZLFNBQVMsQ0FBQ08sU0FBUyxHQUFHLFVBQVVvQixTQUFTLEVBQUU7TUFDakQsSUFBSSxDQUFDQSxTQUFTLEdBQUdBLFNBQVM7TUFDMUIsSUFBSSxDQUFDbkIsS0FBSyxFQUFFO0lBQ2hCLENBQUM7SUFFRHBCLFNBQVMsQ0FBQ1ksU0FBUyxDQUFDTyxTQUFTLENBQUNQLFNBQVMsQ0FBQ1EsS0FBSyxHQUFHLFlBQVk7TUFDeEQsSUFBSSxDQUFDUyxDQUFDLEdBQUczRCxJQUFJLENBQUNzRSxNQUFNLEVBQUUsR0FBRyxJQUFJLENBQUNELFNBQVMsQ0FBQ2pDLEtBQUs7TUFDN0MsSUFBSSxDQUFDcUIsQ0FBQyxHQUFHekQsSUFBSSxDQUFDc0UsTUFBTSxFQUFFLEdBQUcsQ0FBQyxJQUFJLENBQUNELFNBQVMsQ0FBQ2hDLE1BQU07TUFDL0MsSUFBSSxDQUFDcUIsRUFBRSxHQUFHLEdBQUcsR0FBRzFELElBQUksQ0FBQ3NFLE1BQU0sRUFBRSxHQUFHLE9BQU87TUFDdkMsSUFBSSxDQUFDVixFQUFFLEdBQUcsR0FBRyxHQUFHNUQsSUFBSSxDQUFDc0UsTUFBTSxFQUFFO01BQzdCLElBQUksQ0FBQ0wsQ0FBQyxHQUFHLENBQUMsR0FBR2pFLElBQUksQ0FBQ3NFLE1BQU0sRUFBRSxHQUFHLENBQUM7TUFDOUIsSUFBSSxDQUFDUixDQUFDLEdBQUcsQ0FBQztJQUNkLENBQUM7O0lBRUQ7SUFDQXRFLE1BQU0sQ0FBQzRELGdCQUFnQixHQUFJLFlBQVk7TUFDbkMsT0FBTzVELE1BQU0sQ0FBQytFLHFCQUFxQixJQUMvQi9FLE1BQU0sQ0FBQ2dGLDJCQUEyQixJQUNsQ2hGLE1BQU0sQ0FBQ2lGLHdCQUF3QixJQUMvQixVQUFVQyxRQUFRLEVBQUU7UUFDaEJsRixNQUFNLENBQUNtRixVQUFVLENBQUNELFFBQVEsRUFBRSxJQUFJLEdBQUcsRUFBRSxDQUFDO01BQzFDLENBQUM7SUFDVCxDQUFDLEVBQUc7O0lBRUo7SUFDQSxJQUFJRSxLQUFLLEdBQUc3RixRQUFRLENBQUNHLGdCQUFnQixDQUFDLE1BQU0sQ0FBQztJQUM3QzBGLEtBQUssQ0FBQzlELE9BQU8sQ0FBQyxVQUFVK0QsR0FBRyxFQUFFO01BQ3pCLElBQUkvQyxTQUFTLENBQUMrQyxHQUFHLENBQUM7SUFDdEIsQ0FBQyxDQUFDO0VBQ04sQ0FBQyxHQUFHO0VBRUosSUFBTUMsWUFBWSxHQUFHLFNBQWZBLFlBQVksR0FBUTtJQUN0QixJQUFJQyxXQUFXLEdBQUcsQ0FBQztJQUNuQixJQUFJQyxTQUFTLEdBQUcsQ0FBQztJQUNqQixJQUFNQyxnQkFBZ0IsR0FBRyxTQUFuQkEsZ0JBQWdCLENBQUlDLEtBQUssRUFBSztNQUNoQ0gsV0FBVyxHQUFHRyxLQUFLLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsT0FBTztJQUMxQyxDQUFDO0lBQ0QsSUFBTUMsZUFBZSxHQUFHLFNBQWxCQSxlQUFlLENBQUlILEtBQUssRUFBSztNQUMvQkYsU0FBUyxHQUFHRSxLQUFLLENBQUNDLE9BQU8sQ0FBQyxDQUFDLENBQUMsQ0FBQ0MsT0FBTztJQUN4QyxDQUFDO0lBQ0QsSUFBTUUsY0FBYyxHQUFHLFNBQWpCQSxjQUFjLEdBQVM7TUFDekIsSUFBTUMsYUFBYSxHQUFHUixXQUFXLEdBQUdDLFNBQVM7TUFDN0MsSUFBSU8sYUFBYSxHQUFHLEVBQUUsRUFBRTtRQUNwQjtRQUNBN0QsU0FBUyxFQUFFO01BQ2YsQ0FBQyxNQUFNLElBQUk2RCxhQUFhLEdBQUcsQ0FBQyxFQUFFLEVBQUU7UUFDNUI7UUFDQTNELFFBQVEsRUFBRTtNQUNkO01BQ0E7TUFDQW1ELFdBQVcsR0FBRyxDQUFDO01BQ2ZDLFNBQVMsR0FBRyxDQUFDO0lBQ2pCLENBQUM7SUFFRDVGLGVBQWUsQ0FBQzBELGdCQUFnQixDQUFDLE9BQU8sRUFBRXBCLFNBQVMsQ0FBQztJQUNwRHJDLGNBQWMsQ0FBQ3lELGdCQUFnQixDQUFDLE9BQU8sRUFBRWxCLFFBQVEsQ0FBQztJQUNsRDlDLGNBQWMsQ0FBQ2dFLGdCQUFnQixDQUFDLFlBQVksRUFBRW1DLGdCQUFnQixDQUFDO0lBQy9EbkcsY0FBYyxDQUFDZ0UsZ0JBQWdCLENBQUMsV0FBVyxFQUFFdUMsZUFBZSxDQUFDO0lBQzdEdkcsY0FBYyxDQUFDZ0UsZ0JBQWdCLENBQUMsVUFBVSxFQUFFd0MsY0FBYyxDQUFDO0VBQy9ELENBQUM7RUFFRFIsWUFBWSxFQUFFO0FBRWxCLENBQUMsR0FBRyIsImZpbGUiOiJtYWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uICgpIHtcbiAgICAvLyBDYXJkcyBzbGlkZXJcbiAgICBjb25zdCBjYXJkc0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcml6ZV9fbGlzdCcpLFxuICAgICAgICAgIGNhcmRzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbCgnLnByaXplX19saXN0LWl0ZW0nKSxcbiAgICAgICAgICBjYXJkc1dyYXAgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcucHJpemVfX2xpc3Qtc2Nyb2xsJyksXG4gICAgICAgICAgbW92ZVJpZ2h0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByaXplX19zbGlkZXItbW92ZS1yaWdodCcpLFxuICAgICAgICAgIG1vdmVMZWZ0QnV0dG9uID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnByaXplX19zbGlkZXItbW92ZS1sZWZ0JyksXG4gICAgICAgICAgdGFic0NvbnRhaW5lciA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5wcml6ZV9fdGFicycpLFxuICAgICAgICAgIGlzTW9iaWxlID0gd2luZG93LmlubmVyV2lkdGggPCA2MDAsXG4gICAgICAgICAgdG90YWxDYXJkcyA9IGNhcmRzLmxlbmd0aCxcbiAgICAgICAgICBjYXJkV2lkdGggPSBjYXJkc1swXS5jbGllbnRXaWR0aCxcbiAgICAgICAgICBjYXJkc01hcmdpbiA9IChjYXJkc1dyYXAuY2xpZW50V2lkdGggLSBjYXJkV2lkdGggKiB0b3RhbENhcmRzKSAvICh0b3RhbENhcmRzIC0gMSksXG4gICAgICAgICAgdmlzaWJsZVNsaWRlcyA9IGlzTW9iaWxlID8gMSA6IE1hdGguZmxvb3IoY2FyZHNDb250YWluZXIuY2xpZW50V2lkdGggLyAoY2FyZFdpZHRoICsgY2FyZHNNYXJnaW4pKSxcbiAgICAgICAgICB0b3RhbFRhYnMgPSBNYXRoLmNlaWwodG90YWxDYXJkcyAvIHZpc2libGVTbGlkZXMpXG5cbiAgICBsZXQgY3VycmVudFNsaWRlID0gMTtcbiAgICBsZXQgY2FyZHNQb3NpdGlvbiA9IDBcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdG90YWxUYWJzOyBpKyspIHtcbiAgICAgICAgICAgIGlmKCFpc01vYmlsZSAmJiBpID09PSB0b3RhbFRhYnMgKXtcbiAgICAgICAgICAgICAgICBicmVha1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgdGFiID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jyk7XG4gICAgICAgICAgICB0YWIuY2xhc3NMaXN0LmFkZCgncHJpemVfX3RhYnMtaXRlbScpO1xuICAgICAgICAgICAgdGFic0NvbnRhaW5lci5hcHBlbmRDaGlsZCh0YWIpO1xuICAgICAgICB9XG5cbiAgICBjb25zdCB1cGRhdGVBY3RpdmVDYXJkID0gKGNhcmRzLCBhY3RpdmVJbmRleCkgPT4ge1xuICAgICAgICBjYXJkcy5mb3JFYWNoKChjYXJkLCBpKSA9PntcbiAgICAgICAgICAgIGFjdGl2ZUluZGV4IC0gMSA9PT0gaSA/IGNhcmQuY2xhc3NMaXN0LmFkZChcIl9hY3RpdmVcIikgOiBjYXJkLmNsYXNzTGlzdC5yZW1vdmUoXCJfYWN0aXZlXCIpXG4gICAgICAgIH0pXG4gICAgfVxuICAgIHVwZGF0ZUFjdGl2ZUNhcmQoY2FyZHMsIGN1cnJlbnRTbGlkZSlcblxuICAgIGNvbnN0IHVwZGF0ZVRhYnMgPSAoKSA9PiB7XG4gICAgICAgIGNvbnN0IGFjdGl2ZVRhYiA9IE1hdGguY2VpbChjdXJyZW50U2xpZGUgLyB2aXNpYmxlU2xpZGVzKTtcbiAgICAgICAgdGFic0NvbnRhaW5lci5jaGlsZE5vZGVzLmZvckVhY2goKHRhYiwgaW5kZXgpID0+IHtcbiAgICAgICAgICAgIHRhYi5jbGFzc0xpc3QudG9nZ2xlKCdfYWN0aXZlJywgaW5kZXggKyAxID09PSBhY3RpdmVUYWIpO1xuICAgICAgICB9KTtcbiAgICB9O1xuICAgIHVwZGF0ZVRhYnMoKTtcbiAgICBmdW5jdGlvbiBzZXRDYXJkc1Bvc2l0aW9uIChwb3NpdGlvbikge1xuICAgICAgICBjYXJkc1dyYXAuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoLSR7cG9zaXRpb259cHgpYDtcbiAgICB9O1xuICAgIGNvbnN0IG1vdmVSaWdodCA9ICgpID0+IHtcbiAgICAgICAgaWYgKGN1cnJlbnRTbGlkZSA+PSB0b3RhbENhcmRzIC0gdmlzaWJsZVNsaWRlcyAmJiBpc01vYmlsZSA9PT0gZmFsc2UpIHtcbiAgICAgICAgICAgIGN1cnJlbnRTbGlkZSA9IDE7XG4gICAgICAgICAgICBjYXJkc1Bvc2l0aW9uID0gMDtcbiAgICAgICAgfWVsc2UgaWYoY3VycmVudFNsaWRlID09PSB0b3RhbENhcmRzKSB7XG4gICAgICAgICAgICBjdXJyZW50U2xpZGUgPSAxO1xuICAgICAgICAgICAgY2FyZHNQb3NpdGlvbiA9IDA7XG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIGNvbnN0IG1heFBvc2l0aW9uID0gKHRvdGFsQ2FyZHMgLSB2aXNpYmxlU2xpZGVzKSAqIChjYXJkV2lkdGggKyBjYXJkc01hcmdpbik7XG4gICAgICAgICAgICBpZiAoY2FyZHNQb3NpdGlvbiArIGNhcmRXaWR0aCArIGNhcmRzTWFyZ2luID4gbWF4UG9zaXRpb24pIHtcbiAgICAgICAgICAgICAgICBjYXJkc1Bvc2l0aW9uID0gbWF4UG9zaXRpb247XG4gICAgICAgICAgICAgICAgY3VycmVudFNsaWRlID0gdG90YWxDYXJkcyAtIHZpc2libGVTbGlkZXMgKyAxO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICBjYXJkc1Bvc2l0aW9uICs9IGNhcmRXaWR0aCArIGNhcmRzTWFyZ2luO1xuICAgICAgICAgICAgICAgIGN1cnJlbnRTbGlkZSsrO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHNldENhcmRzUG9zaXRpb24oY2FyZHNQb3NpdGlvbik7XG4gICAgICAgIHVwZGF0ZVRhYnMoKTtcbiAgICAgICAgdXBkYXRlQWN0aXZlQ2FyZChjYXJkcywgY3VycmVudFNsaWRlKVxuICAgIH07XG4gICAgY29uc3QgbW92ZUxlZnQgPSAoKSA9PiB7XG4gICAgICAgIGlmKGN1cnJlbnRTbGlkZSA9PT0gMSAmJiBpc01vYmlsZSA9PT0gZmFsc2Upe1xuICAgICAgICAgICAgY3VycmVudFNsaWRlID0gdG90YWxDYXJkcyAtIHZpc2libGVTbGlkZXM7XG4gICAgICAgICAgICBjYXJkc1Bvc2l0aW9uID0gKCh0b3RhbENhcmRzIC0gdmlzaWJsZVNsaWRlcykgKiAoY2FyZFdpZHRoICsgY2FyZHNNYXJnaW4pKSAtKGNhcmRXaWR0aCArIGNhcmRzTWFyZ2luKTtcbiAgICAgICAgfWVsc2UgaWYgKGN1cnJlbnRTbGlkZSA9PT0gMikge1xuICAgICAgICAgICAgY2FyZHNQb3NpdGlvbiA9IDBcbiAgICAgICAgICAgIGN1cnJlbnRTbGlkZSA9IDFcbiAgICAgICAgfWVsc2UgaWYoY3VycmVudFNsaWRlID09PSAxICYmIGlzTW9iaWxlID09PSB0cnVlKXtcbiAgICAgICAgICAgIGN1cnJlbnRTbGlkZSA9IHRvdGFsQ2FyZHNcbiAgICAgICAgICAgIGNhcmRzUG9zaXRpb24gPSB0b3RhbENhcmRzICAqIChjYXJkV2lkdGggKyBjYXJkc01hcmdpbikgLSAoY2FyZFdpZHRoICsgY2FyZHNNYXJnaW4pXG4gICAgICAgIH1lbHNlIHtcbiAgICAgICAgICAgIGNhcmRzUG9zaXRpb24gLT0gY2FyZFdpZHRoICsgY2FyZHNNYXJnaW47XG4gICAgICAgICAgICBjdXJyZW50U2xpZGUtLVxuICAgICAgICB9XG4gICAgICAgIHNldENhcmRzUG9zaXRpb24oY2FyZHNQb3NpdGlvbik7XG4gICAgICAgIHVwZGF0ZVRhYnMoKTtcbiAgICAgICAgdXBkYXRlQWN0aXZlQ2FyZChjYXJkcywgY3VycmVudFNsaWRlKVxuICAgIH07XG5cbiAgICAvLyBmdW5jdGlvbiBjZW50ZXJTdGFydFBvc2l0aW9uKCkge1xuICAgIC8vICAgICAgICAgY29uc3Qgc3RhcnRPZmZzZXQgPSAod2luZG93LmlubmVyV2lkdGggLyAyKSAtICgoY2FyZFdpZHRoICsgY2FyZHNNYXJnaW4pIC8gMik7XG4gICAgLy8gICAgICAgICBjYXJkc1Bvc2l0aW9uID0gc3RhcnRPZmZzZXQgPiAwID8gc3RhcnRPZmZzZXQgOiAwO1xuICAgIC8vICAgICAgICAgc2V0Q2FyZHNQb3NpdGlvbihjYXJkc1Bvc2l0aW9uKTtcbiAgICAvLyB9O1xuXG5cblxuXG5cbiAgICAvLyBzbm93ZmFsbCBhbmltYXRpb25zXG4gICAgKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIENPVU5UID0gNDAwO1xuXG4gICAgICAgIGZ1bmN0aW9uIFNub3dzdG9ybShlbGVtZW50KSB7XG4gICAgICAgICAgICB0aGlzLm1hc3RoZWFkID0gZWxlbWVudDtcbiAgICAgICAgICAgIHRoaXMuY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7XG4gICAgICAgICAgICB0aGlzLmN0eCA9IHRoaXMuY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG4gICAgICAgICAgICB0aGlzLndpZHRoID0gdGhpcy5tYXN0aGVhZC5jbGllbnRXaWR0aDtcbiAgICAgICAgICAgIHRoaXMuaGVpZ2h0ID0gdGhpcy5tYXN0aGVhZC5jbGllbnRIZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLmFjdGl2ZSA9IGZhbHNlO1xuICAgICAgICAgICAgdGhpcy5zbm93Zmxha2VzID0gW107XG5cbiAgICAgICAgICAgIHRoaXMuaW5pdCgpO1xuICAgICAgICB9XG5cbiAgICAgICAgU25vd3N0b3JtLnByb3RvdHlwZS5pbml0ID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuc3R5bGUubGVmdCA9IHRoaXMuY2FudmFzLnN0eWxlLnRvcCA9ICcwJztcbiAgICAgICAgICAgIHRoaXMubWFzdGhlYWQuYXBwZW5kQ2hpbGQodGhpcy5jYW52YXMpO1xuXG4gICAgICAgICAgICB0aGlzLm9uUmVzaXplKCk7XG4gICAgICAgICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgdGhpcy5vblJlc2l6ZS5iaW5kKHRoaXMpLCBmYWxzZSk7XG5cbiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgQ09VTlQ7IGkrKykge1xuICAgICAgICAgICAgICAgIHZhciBzbm93Zmxha2UgPSBuZXcgdGhpcy5Tbm93Zmxha2UodGhpcyk7XG4gICAgICAgICAgICAgICAgc25vd2ZsYWtlLnJlc2V0KCk7XG4gICAgICAgICAgICAgICAgdGhpcy5zbm93Zmxha2VzLnB1c2goc25vd2ZsYWtlKTtcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgcmVxdWVzdEFuaW1GcmFtZSh0aGlzLnVwZGF0ZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBTbm93c3Rvcm0ucHJvdG90eXBlLm9uUmVzaXplID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgdGhpcy53aWR0aCA9IHRoaXMubWFzdGhlYWQuY2xpZW50V2lkdGg7XG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMubWFzdGhlYWQuY2xpZW50SGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB0aGlzLndpZHRoO1xuICAgICAgICAgICAgdGhpcy5jYW52YXMuaGVpZ2h0ID0gdGhpcy5oZWlnaHQ7XG4gICAgICAgICAgICB0aGlzLmN0eC5maWxsU3R5bGUgPSAnI0ZGRic7XG5cbiAgICAgICAgICAgIHZhciB3YXNBY3RpdmUgPSB0aGlzLmFjdGl2ZTtcbiAgICAgICAgICAgIHRoaXMuYWN0aXZlID0gdGhpcy53aWR0aCA+IDgwO1xuICAgICAgICAgICAgdGhpcy53aWR0aCA+IDI4MCA/IENPVU5UID0gMTUwIDogbnVsbFxuXG4gICAgICAgICAgICBpZiAoIXdhc0FjdGl2ZSAmJiB0aGlzLmFjdGl2ZSkge1xuICAgICAgICAgICAgICAgIHJlcXVlc3RBbmltRnJhbWUodGhpcy51cGRhdGUuYmluZCh0aGlzKSk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH07XG5cbiAgICAgICAgU25vd3N0b3JtLnByb3RvdHlwZS51cGRhdGUgPSBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICB0aGlzLmN0eC5jbGVhclJlY3QoMCwgMCwgdGhpcy53aWR0aCwgdGhpcy5oZWlnaHQpO1xuXG4gICAgICAgICAgICBpZiAoIXRoaXMuYWN0aXZlKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuXG4gICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IENPVU5UOyBpKyspIHtcbiAgICAgICAgICAgICAgICB2YXIgc25vd2ZsYWtlID0gdGhpcy5zbm93Zmxha2VzW2ldO1xuICAgICAgICAgICAgICAgIHNub3dmbGFrZS55ICs9IHNub3dmbGFrZS52eTtcbiAgICAgICAgICAgICAgICBzbm93Zmxha2UueCArPSBzbm93Zmxha2Uudng7XG5cbiAgICAgICAgICAgICAgICB0aGlzLmN0eC5nbG9iYWxBbHBoYSA9IHNub3dmbGFrZS5vO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmJlZ2luUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmFyYyhzbm93Zmxha2UueCwgc25vd2ZsYWtlLnksIHNub3dmbGFrZS5yLCAwLCBNYXRoLlBJICogMiwgZmFsc2UpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmNsb3NlUGF0aCgpO1xuICAgICAgICAgICAgICAgIHRoaXMuY3R4LmZpbGwoKTtcblxuICAgICAgICAgICAgICAgIGlmIChzbm93Zmxha2UueSA+IHRoaXMuaGVpZ2h0KSB7XG4gICAgICAgICAgICAgICAgICAgIHNub3dmbGFrZS5yZXNldCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgcmVxdWVzdEFuaW1GcmFtZSh0aGlzLnVwZGF0ZS5iaW5kKHRoaXMpKTtcbiAgICAgICAgfTtcblxuICAgICAgICBTbm93c3Rvcm0ucHJvdG90eXBlLlNub3dmbGFrZSA9IGZ1bmN0aW9uIChzbm93c3Rvcm0pIHtcbiAgICAgICAgICAgIHRoaXMuc25vd3N0b3JtID0gc25vd3N0b3JtO1xuICAgICAgICAgICAgdGhpcy5yZXNldCgpO1xuICAgICAgICB9O1xuXG4gICAgICAgIFNub3dzdG9ybS5wcm90b3R5cGUuU25vd2ZsYWtlLnByb3RvdHlwZS5yZXNldCA9IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHRoaXMueCA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLnNub3dzdG9ybS53aWR0aDtcbiAgICAgICAgICAgIHRoaXMueSA9IE1hdGgucmFuZG9tKCkgKiAtdGhpcy5zbm93c3Rvcm0uaGVpZ2h0O1xuICAgICAgICAgICAgdGhpcy52eSA9IDAuMyArIE1hdGgucmFuZG9tKCkgKiAwLjAwMDAxO1xuICAgICAgICAgICAgdGhpcy52eCA9IDAuNiAtIE1hdGgucmFuZG9tKCk7XG4gICAgICAgICAgICB0aGlzLnIgPSAxICsgTWF0aC5yYW5kb20oKSAqIDI7XG4gICAgICAgICAgICB0aGlzLm8gPSAxO1xuICAgICAgICB9O1xuXG4gICAgICAgIC8vIHNoaW0gbGF5ZXIgd2l0aCBzZXRUaW1lb3V0IGZhbGxiYWNrXG4gICAgICAgIHdpbmRvdy5yZXF1ZXN0QW5pbUZyYW1lID0gKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIHJldHVybiB3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8XG4gICAgICAgICAgICAgICAgd2luZG93LndlYmtpdFJlcXVlc3RBbmltYXRpb25GcmFtZSB8fFxuICAgICAgICAgICAgICAgIHdpbmRvdy5tb3pSZXF1ZXN0QW5pbWF0aW9uRnJhbWUgfHxcbiAgICAgICAgICAgICAgICBmdW5jdGlvbiAoY2FsbGJhY2spIHtcbiAgICAgICAgICAgICAgICAgICAgd2luZG93LnNldFRpbWVvdXQoY2FsbGJhY2ssIDEwMDAgLyA2MCk7XG4gICAgICAgICAgICAgICAgfTtcbiAgICAgICAgfSkoKTtcblxuICAgICAgICAvLyBBcHBseSBTbm93c3Rvcm0gdG8gYWxsIGVsZW1lbnRzIHdpdGggdGhlIGNsYXNzICdza3knXG4gICAgICAgIHZhciBza2llcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy5za3knKTtcbiAgICAgICAgc2tpZXMuZm9yRWFjaChmdW5jdGlvbiAoc2t5KSB7XG4gICAgICAgICAgICBuZXcgU25vd3N0b3JtKHNreSk7XG4gICAgICAgIH0pO1xuICAgIH0pKCk7XG5cbiAgICBjb25zdCBoYW5kbGVSZXNpemUgPSAoKSA9PntcbiAgICAgICAgbGV0IHRvdWNoU3RhcnRYID0gMDtcbiAgICAgICAgbGV0IHRvdWNoRW5kWCA9IDA7XG4gICAgICAgIGNvbnN0IGhhbmRsZVRvdWNoU3RhcnQgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRvdWNoU3RhcnRYID0gZXZlbnQudG91Y2hlc1swXS5jbGllbnRYO1xuICAgICAgICB9O1xuICAgICAgICBjb25zdCBoYW5kbGVUb3VjaE1vdmUgPSAoZXZlbnQpID0+IHtcbiAgICAgICAgICAgIHRvdWNoRW5kWCA9IGV2ZW50LnRvdWNoZXNbMF0uY2xpZW50WDtcbiAgICAgICAgfTtcbiAgICAgICAgY29uc3QgaGFuZGxlVG91Y2hFbmQgPSAoKSA9PiB7XG4gICAgICAgICAgICBjb25zdCBzd2lwZURpc3RhbmNlID0gdG91Y2hTdGFydFggLSB0b3VjaEVuZFg7XG4gICAgICAgICAgICBpZiAoc3dpcGVEaXN0YW5jZSA+IDUwKSB7XG4gICAgICAgICAgICAgICAgLy8g0KHQstCw0LnQvyDQu9GW0LLQvtGA0YPRh1xuICAgICAgICAgICAgICAgIG1vdmVSaWdodCgpO1xuICAgICAgICAgICAgfSBlbHNlIGlmIChzd2lwZURpc3RhbmNlIDwgLTUwKSB7XG4gICAgICAgICAgICAgICAgLy8g0KHQstCw0LnQvyDQv9GA0LDQstC+0YDRg9GHXG4gICAgICAgICAgICAgICAgbW92ZUxlZnQoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIC8vINCh0LrQuNC00LDRlNC80L4g0LfQvdCw0YfQtdC90L3Rj1xuICAgICAgICAgICAgdG91Y2hTdGFydFggPSAwO1xuICAgICAgICAgICAgdG91Y2hFbmRYID0gMDtcbiAgICAgICAgfTtcblxuICAgICAgICBtb3ZlUmlnaHRCdXR0b24uYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCBtb3ZlUmlnaHQpO1xuICAgICAgICBtb3ZlTGVmdEJ1dHRvbi5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIG1vdmVMZWZ0KTtcbiAgICAgICAgY2FyZHNDb250YWluZXIuYWRkRXZlbnRMaXN0ZW5lcigndG91Y2hzdGFydCcsIGhhbmRsZVRvdWNoU3RhcnQpO1xuICAgICAgICBjYXJkc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaG1vdmUnLCBoYW5kbGVUb3VjaE1vdmUpO1xuICAgICAgICBjYXJkc0NvbnRhaW5lci5hZGRFdmVudExpc3RlbmVyKCd0b3VjaGVuZCcsIGhhbmRsZVRvdWNoRW5kKTtcbiAgICB9XG5cbiAgICBoYW5kbGVSZXNpemUoKVxuXG59KSgpOyJdfQ==
